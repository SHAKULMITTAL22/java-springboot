# ********RoostGPT********

# Test generated by RoostGPT for test API-test-Vtal using AI Type Open AI and AI Model gpt-4-turbo
# 
# ROOST_METHOD_HASH=9fc747c059
# ROOST_METHOD_SIG_HASH=e7177c53aa
# 
#  ########## Scenario ########## 
# 
# {
#   feature: 'Feature: Schedule an appointment and notify via communication API',
#   background: 'Background:\r\n' +
#     "        Given the API base URL is 'http://127.0.0.1:4010'\r\n" +
#     "        And the appointment payload is loaded from 'appointmentRequest.json'\r\n" +
#     "        And the communication payload is loaded from 'communicationRequest.json'",
#   rule: null,
#   scenario: {
#     title: 'Scenario: Post an appointment and notify about it',
#     steps: 'Given I search for a time slot with the following parameters:\r\n' +
#       '            | addressId          | 17713                |\r\n' +
#       '            | subscriberId       | VTAL001              |\r\n' +
#       '            | associatedDocument | VTT001               |\r\n' +
#       '            | startDate          | 2023-02-08T18:04:28Z |\r\n' +
#       '            | finishDate         | 2023-02-08T18:04:28Z |\r\n' +
#       '            | orderType          | Instalacao           |\r\n' +
#       "            | productType        | ['Banda Larga']      |\r\n" +
#       "When I send a GET request to '/searchTimeSlot'\r\n" +
#       'Then the response status should be 200\r\n' +
#       'And I save the first slot ID from the response\r\n' +
#       'Given I create an appointment with the saved slot ID\r\n' +
#       "When I send a POST request to '/appointment' with the appointment payload\r\n" +
#       'Then the response status should be 201\r\n' +
#       'And I save the appointment ID from the response\r\n' +
#       "Given I set the communication API base URL to 'http://127.0.0.1:4001'\r\n" +
#       'And I prepare the communication payload with the saved appointment ID\r\n' +
#       "When I send a POST request to '/listener/communicationMessage' with the communication payload\r\n" +
#       'Then the response status should be 204',
#     examples: ''
#   }
# }
# 

# ********RoostGPT********
Feature: Schedule an appointment and notify via communication API

Background:
  * def urlBase = karate.properties['url.base'] || karate.get('urlBase', 'http://localhost:4010')
  * url urlBase
  * def appointmentRequest = read('appointmentRequest.json')
  * def communicationRequest = read('communicationRequest.json')

Scenario: Search for a time slot
  Given path '/searchTimeSlot'
  And param addressId = 17713
  And param subscriberId = 'VTAL001'
  And param associatedDocument = 'VTT001'
  And param startDate = '2023-02-08T18:04:28Z'
  And param finishDate = '2023-02-08T18:04:28Z'
  And param orderType = 'Instalacao'
  And param productType = ['Banda Larga']
  When method get
  Then status 200
  And def firstSlotId = response.slots[0].id

Scenario: Create an appointment with the saved slot ID
  Given path '/appointment'
  And request appointmentRequest
  And set appointmentRequest.appointment.slot.id = firstSlotId
  When method post
  Then status 201
  And def appointmentId = response.appointment.id

Scenario: Communicate about the appointment
  Given path '/listener/communicationMessage'
  And request communicationRequest
  And set communicationRequest.appointmentId = appointmentId
  When method post
  Then status 204
